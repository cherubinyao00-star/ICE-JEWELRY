<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICE JEWELRY - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=Montserrat:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root {
            --ice-white: #FAFBFC;
            --ice-blue: #E8F4F8;
            --ice-silver: #C9D6DF;
            --ice-dark: #1A2930;
            --ice-accent: #4A90A4;
            --ice-gold: #D4AF37;
            --success: #27ae60;
            --danger: #e74c3c;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Montserrat',sans-serif; background:var(--ice-white); color:var(--ice-dark); }

        /* LOGIN */
        #loginView {
            position:fixed; inset:0; z-index:9999;
            background:linear-gradient(135deg,#1A2930 0%,#2d4654 100%);
            display:flex; align-items:center; justify-content:center;
        }
        .login-box {
            background:#fff; border-radius:15px;
            box-shadow:0 20px 60px rgba(0,0,0,.3);
            max-width:420px; width:90%; overflow:hidden;
            animation:fadeUp .5s ease;
        }
        @keyframes fadeUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
        .login-head {
            background:linear-gradient(135deg,#1A2930,#4A90A4);
            padding:2.5rem 2rem; text-align:center; color:#fff;
        }
        .login-head .icon { font-size:2.8rem; margin-bottom:.5rem; }
        .login-head .title { font-family:'Cormorant Garamond',serif; font-size:2.2rem; letter-spacing:4px; font-weight:300; }
        .login-head .sub { font-size:.85rem; letter-spacing:2px; opacity:.9; margin-top:.3rem; }
        .login-body { padding:2.5rem 2rem; }
        .login-body h2 { font-family:'Cormorant Garamond',serif; font-size:1.7rem; font-weight:400; letter-spacing:2px; text-align:center; margin-bottom:1.8rem; }
        .login-body label { font-size:.8rem; font-weight:600; text-transform:uppercase; letter-spacing:1px; display:block; margin-bottom:.4rem; margin-top:1.2rem; }
        .login-body label:first-of-type { margin-top:0; }
        .login-body input[type=text],
        .login-body input[type=password] {
            width:100%; padding:.9rem 1rem; border:2px solid var(--ice-silver);
            border-radius:8px; font-family:'Montserrat',sans-serif; font-size:.95rem;
            background:var(--ice-white); transition:all .3s;
        }
        .login-body input:focus { outline:none; border-color:var(--ice-accent); box-shadow:0 0 0 3px rgba(74,144,164,.1); }
        .pw-wrap { position:relative; }
        .pw-wrap button { position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; font-size:1.1rem; color:#6B7B8C; }
        .btn-login {
            width:100%; margin-top:1.8rem; padding:.95rem;
            background:linear-gradient(135deg,#1A2930,#4A90A4);
            color:#fff; border:none; border-radius:8px;
            font-family:'Montserrat',sans-serif; font-size:1rem;
            font-weight:500; letter-spacing:2px; text-transform:uppercase;
            cursor:pointer; transition:all .3s;
        }
        .btn-login:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(74,144,164,.3); }
        #loginErr { background:#fee; color:#c33; padding:.8rem; border-radius:8px; margin-bottom:1rem; text-align:center; font-size:.88rem; display:none; }
        #loginErr.show { display:block; }
        .login-foot { text-align:center; padding:1rem; background:var(--ice-white); border-top:1px solid var(--ice-silver); font-size:.82rem; color:#6B7B8C; }

        /* DASHBOARD */
        #dashView { display:none; }
        .admin-header {
            background:var(--ice-dark); color:#fff; padding:1rem 2rem;
            display:flex; justify-content:space-between; align-items:center;
            box-shadow:0 2px 10px rgba(0,0,0,.15);
        }
        .admin-logo { font-family:'Cormorant Garamond',serif; font-size:1.6rem; letter-spacing:3px; font-weight:300; }
        .admin-logo small { font-size:.6rem; display:block; opacity:.8; margin-top:2px; }
        .admin-user { display:flex; align-items:center; gap:1rem; font-size:.9rem; }
        .btn-logout { background:var(--danger); color:#fff; border:none; padding:.5rem 1.2rem; border-radius:5px; cursor:pointer; font-family:'Montserrat',sans-serif; font-size:.85rem; }
        .btn-logout:hover { background:#c0392b; }
        .admin-wrap { display:flex; min-height:calc(100vh - 60px); }

        /* Sidebar */
        .sidebar { width:230px; background:#fff; border-right:1px solid var(--ice-silver); padding:1.5rem 0; }
        .sidebar a {
            display:flex; align-items:center; gap:.8rem;
            padding:.9rem 1.5rem; color:var(--ice-dark); text-decoration:none;
            font-size:.92rem; border-left:3px solid transparent; transition:all .3s;
        }
        .sidebar a:hover, .sidebar a.active { background:var(--ice-blue); border-left-color:var(--ice-accent); color:var(--ice-accent); }

        /* Main */
        .main { flex:1; padding:2rem; overflow-y:auto; }
        .page-title { font-family:'Cormorant Garamond',serif; font-size:2.2rem; font-weight:400; letter-spacing:2px; margin-bottom:.3rem; }
        .page-sub { color:#6B7B8C; font-size:.9rem; margin-bottom:1.5rem; }
        .header-row { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem; }

        /* Stats */
        .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1.2rem; margin-bottom:2rem; }
        .stat-card { background:#fff; border:1px solid var(--ice-silver); border-radius:10px; padding:1.2rem; display:flex; align-items:center; gap:1rem; transition:all .3s; }
        .stat-card:hover { transform:translateY(-3px); box-shadow:0 5px 15px rgba(0,0,0,.08); }
        .stat-icon { font-size:2rem; width:55px; height:55px; display:flex; align-items:center; justify-content:center; background:var(--ice-blue); border-radius:10px; }
        .stat-info h3 { font-size:1.6rem; font-weight:600; }
        .stat-info p { font-size:.78rem; color:#6B7B8C; text-transform:uppercase; letter-spacing:1px; }

        /* Sections */
        .section { display:none; }
        .section.active { display:block; }

        /* Card / Table */
        .card { background:#fff; border:1px solid var(--ice-silver); border-radius:10px; overflow:hidden; }
        .card-head { display:flex; justify-content:space-between; align-items:center; padding:1.2rem 1.5rem; border-bottom:1px solid var(--ice-silver); }
        .card-head h3 { font-family:'Cormorant Garamond',serif; font-size:1.4rem; font-weight:400; letter-spacing:1px; }
        .search-input { padding:.55rem .9rem; border:1px solid var(--ice-silver); border-radius:5px; font-family:'Montserrat',sans-serif; font-size:.88rem; width:260px; }
        table { width:100%; border-collapse:collapse; }
        thead { background:var(--ice-blue); }
        th { padding:.9rem 1rem; text-align:left; font-size:.8rem; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        td { padding:.9rem 1rem; border-bottom:1px solid var(--ice-silver); font-size:.9rem; }
        tbody tr:hover { background:var(--ice-white); }

        /* Badges */
        .badge { padding:.3rem .9rem; border-radius:20px; font-size:.75rem; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
        .badge-pending { background:#fff3cd; color:#856404; }
        .badge-processing { background:#cce5ff; color:#004085; }
        .badge-delivered { background:#d4edda; color:#155724; }
        .badge-active { background:#d4edda; color:#155724; }
        .badge-inactive { background:#fff3cd; color:#856404; }

        /* Buttons */
        .btn { padding:.55rem 1.1rem; border:none; border-radius:5px; cursor:pointer; font-family:'Montserrat',sans-serif; font-size:.85rem; transition:all .3s; }
        .btn-primary { background:var(--ice-accent); color:#fff; }
        .btn-primary:hover { background:#3a7a8a; }
        .btn-danger { background:var(--danger); color:#fff; }
        .btn-danger:hover { background:#c0392b; }
        .btn-secondary { background:var(--ice-silver); color:var(--ice-dark); }
        .btn-secondary:hover { background:#b0c0cf; }
        .btn-sm { padding:.4rem .8rem; font-size:.8rem; }

        /* Products */
        .products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:1.2rem; }
        .prod-card { background:#fff; border:1px solid var(--ice-silver); border-radius:10px; overflow:hidden; transition:all .3s; }
        .prod-card:hover { transform:translateY(-4px); box-shadow:0 5px 18px rgba(0,0,0,.1); }
        .prod-img { width:100%; height:180px; background:var(--ice-blue); display:flex; align-items:center; justify-content:center; overflow:hidden; }
        .prod-img img { width:100%; height:100%; object-fit:cover; }
        .prod-img .placeholder { font-size:3rem; opacity:.4; }
        .prod-details { padding:1rem; }
        .prod-details .name { font-weight:600; margin-bottom:.3rem; }
        .prod-details .cat { font-size:.8rem; color:#6B7B8C; margin-bottom:.4rem; }
        .prod-details .price { color:var(--ice-accent); font-weight:700; font-size:1.05rem; margin-bottom:.8rem; }
        .prod-btns { display:flex; gap:.5rem; }
        .prod-btns button { flex:1; }

        /* Status select */
        .status-select { border:none; font-family:'Montserrat',sans-serif; font-size:.82rem; cursor:pointer; padding:.3rem .6rem; border-radius:15px; }
        .status-select.pending { background:#fff3cd; color:#856404; }
        .status-select.processing { background:#cce5ff; color:#004085; }
        .status-select.delivered { background:#d4edda; color:#155724; }

        /* Modals */
        .modal { display:none; position:fixed; inset:0; background:rgba(26,41,48,.88); z-index:5000; align-items:center; justify-content:center; }
        .modal.active { display:flex; }
        .modal-box { background:#fff; border-radius:12px; padding:2rem; max-width:560px; width:92%; max-height:88vh; overflow-y:auto; position:relative; }
        .modal-box h2 { font-family:'Cormorant Garamond',serif; font-size:1.8rem; font-weight:400; letter-spacing:2px; margin-bottom:1.5rem; }
        .modal-close { position:absolute; top:1rem; right:1.2rem; background:none; border:none; font-size:1.8rem; cursor:pointer; color:var(--ice-dark); }
        .fg { margin-bottom:1.2rem; }
        .fg label { display:block; font-size:.82rem; font-weight:600; margin-bottom:.4rem; }
        .fg input, .fg select, .fg textarea {
            width:100%; padding:.75rem; border:1px solid var(--ice-silver);
            border-radius:6px; font-family:'Montserrat',sans-serif; font-size:.9rem;
        }
        .fg input:focus, .fg select:focus, .fg textarea:focus { outline:none; border-color:var(--ice-accent); }
        .fg textarea { resize:vertical; min-height:80px; }
        .img-preview { width:180px; height:180px; border:2px dashed var(--ice-silver); border-radius:8px; display:flex; align-items:center; justify-content:center; margin-top:.8rem; overflow:hidden; }
        .img-preview img { max-width:100%; max-height:100%; object-fit:contain; }
        .modal-btns { display:flex; gap:.8rem; margin-top:1.5rem; }
        .modal-btns button { flex:1; }

        /* Order detail */
        .order-section { background:var(--ice-blue); padding:1.2rem; border-radius:8px; margin-bottom:1rem; }
        .order-section h4 { margin-bottom:.7rem; font-size:1rem; }
        .order-section p { margin:.35rem 0; font-size:.9rem; }
        .order-items-row { display:flex; justify-content:space-between; padding:.6rem 0; border-bottom:1px solid var(--ice-silver); font-size:.9rem; }
        .total-row { display:flex; justify-content:space-between; padding:.7rem 0; font-size:1rem; }
        .total-row.big { font-size:1.2rem; font-weight:700; border-top:2px solid var(--ice-accent); margin-top:.5rem; padding-top:.8rem; }

        .empty { text-align:center; padding:3rem; color:#6B7B8C; }
        .empty .icon { font-size:3rem; margin-bottom:.8rem; }
    
        
        button i[data-lucide],
        a i[data-lucide] {
            margin-right: 0.3em;
        }
    

/* ========================================
   ADMIN DASHBOARD - RESPONSIVE
======================================== */

@media (max-width: 1024px) {
    .sidebar {
        width: 220px;
    }
    
    .main-content {
        margin-left: 220px;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .sidebar {
        position: fixed;
        left: -250px;
        width: 250px;
        transition: left 0.3s ease;
        z-index: 2000;
        box-shadow: 2px 0 10px rgba(0,0,0,0.3);
    }
    
    .sidebar.active {
        left: 0;
    }
    
    .main-content {
        margin-left: 0;
        padding: 1.5rem 1rem;
    }
    
    .header-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .orders-table {
        overflow-x: auto;
    }
    
    table {
        min-width: 600px;
    }
    
    .modal-box {
        width: 95%;
        max-width: 95%;
        padding: 1.5rem;
    }
    
    .form-row {
        flex-direction: column;
    }
    
    .fg {
        width: 100%;
    }
}

@media (max-width: 480px) {
    .login-box {
        width: 95%;
        padding: 1.5rem;
    }
    
    .login-head {
        padding: 2rem 1.5rem;
    }
    
    .login-head .title {
        font-size: 1.8rem;
    }
    
    .page-title {
        font-size: 1.8rem;
    }
    
    .btn {
        padding: 0.7rem 1.2rem;
        font-size: 0.9rem;
    }
    
    .card {
        padding: 1rem;
    }
    
    .card-head h3 {
        font-size: 1.1rem;
    }
}

/* Hamburger menu for admin (optional) */
.admin-toggle {
    display: none;
    position: fixed;
    top: 1rem;
    left: 1rem;
    z-index: 2001;
    background: var(--ice-dark);
    color: white;
    border: none;
    padding: 0.8rem;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

@media (max-width: 768px) {
    .admin-toggle {
        display: block;
    }
    
    #dashView {
        padding-top: 60px;
    }
}

/* Touch-friendly elements */
@media (max-width: 768px) {
    .nav-link,
    button,
    a,
    .btn {
        min-height: 44px;
    }
    
    input,
    textarea,
    select {
        font-size: 16px !important;
        padding: 0.8rem;
    }
}


</style>
    
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

<!-- LOGIN -->
<div id="loginView">
  <div class="login-box">
    <div class="login-head">
      <div class="icon"><i data-lucide="lock"></i></div>
      <div class="title">ICE JEWELRY</div>
      <div class="sub">BY MOSTPE</div>
    </div>
    <div class="login-body">
      <h2>Espace Admin</h2>
      <div id="loginErr"><i data-lucide="x"></i> Identifiant ou mot de passe incorrect</div>
      <form id="loginForm">
        <label>Identifiant</label>
        <input type="text" id="inpUser" autocomplete="off" placeholder="Identifiant" required>
        <label>Mot de passe</label>
        <div class="pw-wrap">
          <input type="password" id="inpPass" autocomplete="off" placeholder="Mot de passe" required>
          <button type="button" id="togglePw"><i data-lucide="eye"></i></button>
        </div>
        <button type="submit" class="btn-login">Se connecter</button>
      </form>
    </div>
    <div class="login-foot">© 2026 ICE JEWELRY – Tous droits réservés</div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashView">
  <button class="admin-toggle" id="adminToggle">☰ Menu</button>

  <header class="admin-header">
    <div class="admin-logo">ICE JEWELRY <small>BY MOSTPE – ADMIN</small></div>
    <div class="admin-user">
      <span><i data-lucide="user"></i> Administrateur</span>
      <button class="btn-logout" onclick="logout()">Déconnexion</button>
    </div>
  </header>
  <div class="admin-wrap">
    <nav class="sidebar">
      <a href="#" class="nav-link active" data-sec="secDashboard"><i data-lucide="bar-chart-2"></i> Dashboard</a>
      <a href="#" class="nav-link" data-sec="secOrders"><i data-lucide="shopping-cart"></i> Commandes</a>
      <a href="#" class="nav-link" data-sec="secProducts"><i data-lucide="gem"></i> Produits</a>
      <a href="#" class="nav-link" data-sec="secCategories"><i data-lucide="folder"></i> Catégories</a>
      <a href="#" class="nav-link" data-sec="secAnnouncements"><i data-lucide="megaphone"></i> Annonces</a>
          <a href="#" class="nav-link" data-sec="secSettings"><i data-lucide="settings"></i> Paramètres</a>
    </nav>
    <div class="main">
      <!-- Dashboard -->
      <div id="secDashboard" class="section active">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-sub">Vue ensemble de votre boutique</p>
        <div style="margin-top:1rem;">
            <button class="btn btn-danger btn-sm" onclick="if(confirm('Supprimer TOUTES les commandes ?')){clearAllOrders();renderDashboard();renderOrders();alert('Toutes les commandes ont été supprimées !');}">
                <i data-lucide="trash-2"></i> Vider toutes les commandes
            </button>
        </div>
        <div class="stats">
          <div class="stat-card"><div class="stat-icon"><i data-lucide="shopping-cart"></i></div><div class="stat-info"><h3 id="statOrders">0</h3><p>Commandes</p></div></div>
          <div class="stat-card"><div class="stat-icon"><i data-lucide="gem"></i></div><div class="stat-info"><h3 id="statProducts">0</h3><p>Produits</p></div></div>
          <div class="stat-card"><div class="stat-icon"><i data-lucide="folder"></i></div><div class="stat-info"><h3 id="statCategories">0</h3><p>Catégories</p></div></div>
          <div class="stat-card"><div class="stat-icon"><i data-lucide="dollar-sign"></i></div><div class="stat-info"><h3 id="statRevenue">0 FCFA</h3><p>Chiffre affaires</p></div></div>
        </div>
        <div class="card"><div class="card-head"><h3>Dernières commandes</h3></div><div id="recentOrders"></div></div>
      </div>
      <!-- Orders -->
      <div id="secOrders" class="section">
        <h1 class="page-title">Commandes</h1><p class="page-sub">Gérez toutes vos commandes</p
        <div style="margin-top:1rem;">
            <button class="btn btn-danger btn-sm" onclick="if(confirm('Êtes-vous sûr de vouloir supprimer TOUTES les commandes ? Cette action est irréversible.')){clearAllOrders();renderOrders();renderDashboard();alert('<i data-lucide="check-circle"></i> Toutes les commandes ont été supprimées.');}">
                <i data-lucide="trash-2"></i> Supprimer toutes les commandes
            </button>
        </div>>
        <div class="card">
          <div class="card-head"><h3>Toutes les commandes</h3><input type="text" class="search-input" id="searchOrders" placeholder="Rechercher..."></div>
          <div id="ordersTable"></div>
        </div>
      </div>
      <!-- Products -->
      <div id="secProducts" class="section">
        <div class="header-row"><div><h1 class="page-title">Produits</h1><p class="page-sub">Gérez votre catalogue</p></div><button class="btn btn-primary" onclick="openProductModal(null)"><i data-lucide="plus"></i> Ajouter un produit</button></div>
        <div id="productsGrid" class="products-grid"></div>
      </div>
      <!-- Categories -->
      <div id="secCategories" class="section">
        <div class="header-row"><div><h1 class="page-title">Catégories</h1><p class="page-sub">Organisez vos produits</p></div><button class="btn btn-primary" onclick="openCategoryModal()"><i data-lucide="plus"></i> Ajouter une catégorie</button></div>
        <div class="card"><div class="card-head"><h3>Toutes les catégories</h3></div><div id="categoriesTable"></div></div>
      </div>
      <!-- Announcements -->
      <div id="secAnnouncements" class="section">
        <div class="header-row"><div><h1 class="page-title">Annonces</h1><p class="page-sub">Gérez la barre d annonces</p></div><button class="btn btn-primary" onclick="openAnnouncementModal()"><i data-lucide="plus"></i> Nouvelle annonce</button></div>
        <div class="card"><div class="card-head"><h3>Annonces</h3></div><div id="announcementsTable"></div></div>
      </div>
    </div>
  </div>
</div>


      <!-- Settings Section -->
      <div id="secSettings" class="section">
        <div class="header-row">
          <div><h1 class="page-title">Paramètres</h1><p class="page-sub">Gérez les paramètres du site</p></div>
        </div>

        <!-- Changer les identifiants -->
        <div class="card" style="margin-bottom:2rem;">
          <div class="card-head"><h3><i data-lucide="shield"></i> Sécurité - Changer vos identifiants</h3></div>
          <div style="padding:1.5rem;">
            <div style="background:#fff3cd; border-left:4px solid #f39c12; padding:1rem; margin-bottom:1.5rem; border-radius:5px;">
              <strong>⚠️ Important :</strong> Après avoir changé vos identifiants, notez-les bien ! Vous devrez utiliser les nouveaux pour vous connecter.
            </div>
            
            <form id="changeCredsForm">
              <div class="fg">
                <label><i data-lucide="user"></i> Nouvel identifiant</label>
                <input type="text" id="newUsername" class="form-control" required placeholder="Votre nouvel identifiant">
                <small style="color:#6B7B8C; font-size:0.85rem;">Minimum 5 caractères</small>
              </div>
              
              <div class="fg">
                <label><i data-lucide="lock"></i> Nouveau mot de passe</label>
                <input type="password" id="newPassword" class="form-control" required placeholder="Votre nouveau mot de passe">
                <small style="color:#6B7B8C; font-size:0.85rem;">Minimum 8 caractères, avec lettres et chiffres</small>
              </div>
              
              <div class="fg">
                <label><i data-lucide="lock"></i> Confirmer le mot de passe</label>
                <input type="password" id="confirmPassword" class="form-control" required placeholder="Confirmez le mot de passe">
              </div>
              
              <div style="margin-top:2rem;">
                <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Enregistrer les nouveaux identifiants</button>
              </div>
            </form>
            
            <div id="credsChangeResult" style="margin-top:1rem;"></div>
          </div>
        </div>

        <!-- Réseaux sociaux -->
        <div class="card">
          <div class="card-head"><h3><i data-lucide="share-2"></i> Réseaux sociaux</h3></div>
          <div style="padding:1.5rem;">
            <form id="socialLinksForm">
              <div class="fg">
                <label><i data-lucide="smartphone"></i> Numéro WhatsApp (format international)</label>
                <input type="tel" class="form-control" id="whatsappNumber" placeholder="225XXXXXXXXXX" value="2250000000000">
                <small style="color:#6B7B8C; font-size:0.85rem;">Format: 225XXXXXXXXXX (sans espaces, ni +)</small>
              </div>
              
              <div class="fg">
                <label><i data-lucide="music"></i> Nom d'utilisateur TikTok</label>
                <input type="text" class="form-control" id="tiktokUsername" placeholder="@icejewelry" value="@icejewelry">
                <small style="color:#6B7B8C; font-size:0.85rem;">Avec ou sans @ au début</small>
              </div>
              
              <div class="fg">
                <label><i data-lucide="mail"></i> Email de contact</label>
                <input type="email" class="form-control" id="contactEmail" placeholder="contact@icejewelry.ci" value="contact@icejewelry.ci">
              </div>
              
              <div class="fg">
                <label><i data-lucide="phone"></i> Téléphone de contact</label>
                <input type="tel" class="form-control" id="contactPhone" placeholder="+225 XX XX XX XX XX" value="+225 XX XX XX XX XX">
              </div>
              
              <div style="margin-top:2rem;">
                <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Enregistrer les paramètres</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Zone dangereuse -->
        <div class="card" style="margin-top:1.5rem; border:2px solid var(--danger);">
          <div class="card-head" style="background:var(--danger); color:white;"><h3><i data-lucide="alert-triangle"></i> Zone dangereuse</h3></div>
          <div style="padding:1.5rem;">
            <p style="margin-bottom:1rem; color:#6B7B8C;">Actions irréversibles - Utilisez avec précaution</p>
            <button class="btn btn-danger" onclick="if(confirm('Supprimer TOUTES les données ?')){clearAllData(); alert('Toutes les données ont été supprimées');}">
              <i data-lucide="trash-2"></i> Réinitialiser toutes les données
            </button>
            <button class="btn btn-danger" style="margin-left:1rem;" onclick="resetToDefaultCredentials()">
              <i data-lucide="rotate-ccw"></i> Réinitialiser les identifiants par défaut
            </button>
          </div>
        </div>
      </div>

      <!-- MODALS -->
<div class="modal" id="modalOrderDetail">
  <div class="modal-box" style="max-width:600px;">
    <button class="modal-close" onclick="closeModal('modalOrderDetail')">&times;</button>
    <h2>Détails commande</h2>
    <div id="orderDetailBody"></div>
  </div>
</div>
<div class="modal" id="modalProduct">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal('modalProduct')">&times;</button>
    <h2 id="productModalTitle">Ajouter un produit</h2>
    <form id="productForm">
      <div class="fg">
        <label>Nom *</label>
        <input type="text" id="pName" class="form-control" required placeholder="Ex: Collier en Or">
      </div>
      
      <div class="fg">
        <label>Catégorie *</label>
        <select id="pCat" class="form-control" required>
          <option value="">-- Sélectionner --</option>
        </select>
      </div>
      
      <div class="fg">
        <label>Prix (FCFA) *</label>
        <input type="number" id="pPrice" class="form-control" required placeholder="Ex: 15000">
      </div>
      
      <div class="fg">
        <label>Description</label>
        <textarea id="pDesc" class="form-control" rows="3" placeholder="Description du produit"></textarea>
      </div>
      
      <div class="fg">
        <label><i data-lucide="image"></i> Images du produit (Jusqu'à 5 photos)</label>
        <input type="file" id="pImages" class="form-control" multiple accept="image/*" style="padding:0.6rem;">
        <small style="color:#6B7B8C; font-size:0.85rem;">Maintenez Ctrl (ou Cmd sur Mac) pour sélectionner plusieurs images</small>
        
        <!-- Prévisualisation des images -->
        <div id="imagePreview" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); gap:0.5rem; margin-top:1rem;">
          <!-- Les previews apparaîtront ici -->
        </div>
      </div>
      
      <div class="fg">
        <label>
          <input type="checkbox" id="pIsNew" style="width:auto; margin-right:0.5rem;">
          <i data-lucide="sparkles"></i> Marquer comme NOUVEAUTÉ
        </label>
        <small style="display:block; color:#6B7B8C; font-size:0.85rem; margin-top:0.3rem;">
          Les nouveautés apparaîtront dans le carousel en page d'accueil
        </small>
      </div>
      
      <input type="hidden" id="pId">
      <div class="modal-btns">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalProduct')">Annuler</button>
        <button type="submit" class="btn btn-primary"><i data-lucide="save"></i> Enregistrer</button>
      </div>
    </form>
  </div>
</div>
<div class="modal" id="modalCategory">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal('modalCategory')">&times;</button>
    <h2>Nouvelle catégorie</h2>
    <form id="categoryForm">
      <div class="fg"><label>Nom *</label><input type="text" id="cName" required></div>
      <div class="fg"><label>Description</label><textarea id="cDesc"></textarea></div>
      <div class="modal-btns">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalCategory')">Annuler</button>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
      </div>
    </form>
  </div>
</div>
<div class="modal" id="modalAnnouncement">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal('modalAnnouncement')">&times;</button>
    <h2>Nouvelle annonce</h2>
    <form id="announcementForm">
      <div class="fg"><label>Message *</label><textarea id="aText" required placeholder="Ex: Nouvelle collection – 20% de réduction !"></textarea></div>
      <div class="fg"><label>Statut</label><select id="aStatus"><option value="active">Active</option><option value="inactive">Inactive</option></select></div>
      <div class="modal-btns">
        <button type="button" class="btn btn-secondary" onclick="closeModal('modalAnnouncement')">Annuler</button>
        <button type="submit" class="btn btn-primary">Enregistrer</button>
      </div>
    </form>
  </div>
</div>

<script>
// ============================================================
// <i data-lucide="lock"></i>  CHANGEZ VOS IDENTIFIANTS ICI
// ============================================================
// Identifiants hashés (aucune information visible)
        var ADMIN_USER_HASH = '837d4a36b2787a87b7b5d683afca96cc655518fc3e8ae24f3a271d50aa828669';
        var ADMIN_PASS_HASH = 'c6b0312eda445919a5903e8a5b41767ae1ab110edda15afb38775269376cf72f';
        
        // Récupérer les hash depuis localStorage (si changés)
        if (localStorage.getItem('customUserHash')) {
            ADMIN_USER_HASH = localStorage.getItem('customUserHash');
        }
        if (localStorage.getItem('customPassHash')) {
            ADMIN_PASS_HASH = localStorage.getItem('customPassHash');
        } // Hash SHA-256 sécurisé
// ============================================================


/* ---------- DATA helpers ---------- */
function getOrders()       { return JSON.parse(localStorage.getItem('iceJewelryOrders') || '[]'); }
function saveOrders(a)     { localStorage.setItem('iceJewelryOrders', JSON.stringify(a)); }
function clearAllOrders()  { localStorage.removeItem('iceJewelryOrders'); }

function getProducts()     { return JSON.parse(localStorage.getItem('iceJewelryProducts') || '[]'); }
function saveProducts(a)   { localStorage.setItem('iceJewelryProducts', JSON.stringify(a)); }
function getCategories()   { return JSON.parse(localStorage.getItem('iceJewelryCategories') || '[{"id":"colliers","name":"Colliers","description":"Collection de colliers"},{"id":"bracelets","name":"Bracelets","description":"Collection de bracelets"}]'); }
function saveCategories(a) { localStorage.setItem('iceJewelryCategories', JSON.stringify(a)); }
function getAnnouncements(){ return JSON.parse(localStorage.getItem('iceJewelryAnnouncements') || '[]'); }
function saveAnnouncements(a){ localStorage.setItem('iceJewelryAnnouncements', JSON.stringify(a)); }
function fmt(n){ return Math.round(n).toLocaleString('fr-FR'); }
function statusLabel(s){ return s==='processing'?'En préparation':s==='delivered'?'Livrée':'En attente'; }
function closeModal(id){ document.getElementById(id).classList.remove('active'); }

/* ---------- LOGIN ---------- */
document.getElementById('togglePw').addEventListener('click', function(){
    var inp = document.getElementById('inpPass');
    inp.type = inp.type==='password'?'text':'password';
    this.textContent = inp.type==='text'?'<i data-lucide="eye-off"></i>':'<i data-lucide="eye"></i>'; });
// Fonction de hashage sécurisé
async function hashPassword(password) {
    const msgBuffer = new TextEncoder().encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

document.getElementById('loginForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const user = document.getElementById('inpUser').value.trim();
    const pass = document.getElementById('inpPass').value;
    const userHash = await hashPassword(user);
    const passHash = await hashPassword(pass);
    
    if(userHash === ADMIN_USER_HASH && passHash === ADMIN_PASS_HASH){
        document.getElementById('loginView').style.display='none';
        document.getElementById('dashView').style.display='block';
        renderDashboard();
    } else {
        var err=document.getElementById('loginErr');
        err.classList.add('show');
        document.getElementById('inpPass').value='';
        setTimeout(function(){err.classList.remove('show');},3000);
    }
});
function logout(){
    document.getElementById('dashView').style.display='none';
    document.getElementById('loginView').style.display='block';
    document.getElementById('inpUser').value='';
    document.getElementById('inpPass').value='';
}

/* ---------- SIDEBAR ---------- */
document.querySelectorAll('.nav-link').forEach(function(link){
    link.addEventListener('click', function(e){
        e.preventDefault();
        document.querySelectorAll('.nav-link').forEach(function(l){l.classList.remove('active');});
        this.classList.add('active');
        document.querySelectorAll('.section').forEach(function(s){s.classList.remove('active');});
        var id=this.getAttribute('data-sec');
        document.getElementById(id).classList.add('active');
        if(id==='secDashboard')     renderDashboard();
        if(id==='secOrders')        renderOrders();
        if(id==='secProducts')      renderProducts();
        if(id==='secCategories')    renderCategories();
        if(id==='secAnnouncements') renderAnnouncements();
    });
});

/* ---------- DASHBOARD ---------- */
    if(id==='secSettings')       renderSettings();
function renderDashboard(){
    var orders=getOrders(), products=getProducts(), categories=getCategories();
    document.getElementById('statOrders').textContent=orders.length;
    document.getElementById('statProducts').textContent=products.length;
    document.getElementById('statCategories').textContent=categories.length;
    var rev=orders.reduce(function(s,o){return s+(o.pricing?o.pricing.total:0);},0);
    document.getElementById('statRevenue').textContent=fmt(rev)+' FCFA';
    var recent=orders.slice().reverse().slice(0,5);
    if(!recent.length){document.getElementById('recentOrders').innerHTML='<div class="empty"><div class="icon"><i data-lucide="package"></i></div><p>Aucune commande</p></div>';return;}
    var h='<table><thead><tr><th>N°</th><th>Client</th><th>Total</th><th>Date</th><th>Statut</th></tr></thead><tbody>';
    recent.forEach(function(o){
        h+='<tr><td><strong>'+(o.orderNumber||'N/A')+'</strong></td><td>'+(o.customer?o.customer.name:'N/A')+'</td><td><strong>'+fmt(o.pricing?o.pricing.total:0)+' FCFA</strong></td><td>'+new Date(o.timestamp).toLocaleDateString('fr-FR')+'</td><td><span class="badge badge-'+(o.status||'pending')+'">'+statusLabel(o.status)+'</span></td></tr>';
    });
    document.getElementById('recentOrders').innerHTML=h+'</tbody></table>';
}

/* ---------- ORDERS ---------- */
function renderOrders(){
    var orders=getOrders().slice().reverse();
    if(!orders.length){document.getElementById('ordersTable').innerHTML='<div class="empty"><div class="icon"><i data-lucide="package"></i></div><p>Aucune commande</p></div>';return;}
    var h='<table><thead><tr><th>N°</th><th>Client</th><th>Tel</th><th>Commune</th><th>Total</th><th>Date</th><th>Statut</th><th>Action</th></tr></thead><tbody>';
    orders.forEach(function(o,i){
        var ri=getOrders().length-1-i;
        h+='<tr><td><strong>'+(o.orderNumber||'N/A')+'</strong></td><td>'+(o.customer?o.customer.name:'')+'</td><td>'+(o.customer?o.customer.phone:'')+'</td><td>'+(o.customer?o.customer.commune:'')+'</td><td><strong>'+fmt(o.pricing?o.pricing.total:0)+' FCFA</strong></td><td>'+new Date(o.timestamp).toLocaleDateString('fr-FR')+'</td>'+
        '<td><select class="status-select '+(o.status||'pending')+'" onchange="changeStatus('+ri+',this.value)"><option value="pending"'+(o.status==='pending'?' selected':'')+'>En attente</option><option value="processing"'+(o.status==='processing'?' selected':'')+'>En préparation</option><option value="delivered"'+(o.status==='delivered'?' selected':'')+'>Livrée</option></select></td>'+
        '<td><button class="btn btn-primary btn-sm" onclick="showOrderDetail('+ri+')">Détails</button></td></tr>';
    });
    document.getElementById('ordersTable').innerHTML=h+'</tbody></table>';
}
function changeStatus(idx,val){ var o=getOrders(); o[idx].status=val; saveOrders(o); renderOrders(); renderDashboard(); }
function showOrderDetail(idx){
    var o=getOrders()[idx];
    var h='<div class="order-section"><h4><i data-lucide="map-pin"></i> Client</h4><p><strong>Nom :</strong> '+(o.customer?o.customer.name:'')+'</p><p><strong>Téléphone :</strong> '+(o.customer?o.customer.phone:'')+'</p><p><strong>Adresse :</strong> '+(o.customer?o.customer.address:'')+'</p><p><strong>Commune :</strong> '+(o.customer?o.customer.commune:'')+'</p>'+(o.customer&&o.customer.notes?'<p><strong>Notes :</strong> '+o.customer.notes+'</p>':'')+' </div>';
    h+='<div class="order-section" style="background:#fff;border:1px solid var(--ice-silver);"><h4><i data-lucide="shopping-bag"></i> Articles</h4>';
    if(o.items) o.items.forEach(function(item){ h+='<div class="order-items-row"><div><strong>'+item.name+'</strong><br><span style="font-size:.82rem;color:#6B7B8C;">Qté : '+item.quantity+' × '+fmt(item.price)+' FCFA</span></div><div style="text-align:right;color:var(--ice-accent);font-weight:600;">'+fmt(item.price*item.quantity)+' FCFA</div></div>'; });
    h+='</div><div class="order-section"><div class="total-row"><span>Sous-total :</span><strong>'+fmt(o.pricing?o.pricing.subtotal:0)+' FCFA</strong></div><div class="total-row"><span>Livraison :</span><strong>'+fmt(o.pricing?o.pricing.delivery:0)+' FCFA</strong></div><div class="total-row big"><span>TOTAL :</span><strong style="color:var(--ice-accent);">'+fmt(o.pricing?o.pricing.total:0)+' FCFA</strong></div></div>';
    h+='<div style="margin-top:1rem;padding:1rem;background:#FFF9E6;border-left:4px solid var(--ice-gold);border-radius:5px;"><p><strong>Date :</strong> '+new Date(o.timestamp).toLocaleString('fr-FR')+'</p><p><strong>N° :</strong> '+(o.orderNumber||'')+'</p><p><strong>Statut :</strong> <span class="badge badge-'+(o.status||'pending')+'">'+statusLabel(o.status)+'</span></p></div>';
    document.getElementById('orderDetailBody').innerHTML=h;
    document.getElementById('modalOrderDetail').classList.add('active');
}
document.getElementById('searchOrders').addEventListener('input', function(){
    var q=this.value.toLowerCase();
    document.querySelectorAll('#ordersTable tbody tr').forEach(function(r){r.style.display=r.textContent.toLowerCase().includes(q)?'':'none';});
});

/* ---------- PRODUCTS ---------- */
var editIdx=null;
function renderProducts(){
    var products=getProducts(), cats=getCategories();
    var sel=document.getElementById('pCategory'); sel.innerHTML='';
    cats.forEach(function(c){sel.innerHTML+='<option value="'+c.id+'">'+c.name+'</option>';});
    if(!products.length){document.getElementById('productsGrid').innerHTML='<div class="empty"><div class="icon"><i data-lucide="gem"></i></div><p>Aucun produit. Cliquez sur Ajouter !</p></div>';return;}
    var h='';
    products.forEach(function(p,i){
        var cn=cats.find(function(c){return c.id===p.category;});
        h+='<div class="prod-card"><div class="prod-img">'+(p.image?'<img src="'+p.image+'" alt="'+p.name+'">':'<div class="placeholder"><i data-lucide="gem"></i></div>')+'</div><div class="prod-details"><div class="name">'+p.name+'</div><div class="cat">'+(cn?cn.name:'')+'</div><div class="price">'+fmt(p.price)+' FCFA</div><div class="prod-btns"><button class="btn btn-secondary btn-sm" onclick="openProductModal('+i+')"><i data-lucide="edit"></i> Modifier</button><button class="btn btn-danger btn-sm" onclick="deleteProduct('+i+')"><i data-lucide="trash-2"></i></button></div></div></div>';
    });
    document.getElementById('productsGrid').innerHTML=h;
}
function openProductModal(idx){
    editIdx=idx;
    var products=getProducts();
    if(idx!==null){
        var p=products[idx];
        document.getElementById('productModalTitle').textContent='Modifier le produit';
        document.getElementById('pName').value=p.name;
        document.getElementById('pCategory').value=p.category;
        document.getElementById('pDesc').value=p.description||'';
        document.getElementById('pPrice').value=p.price;
        document.getElementById('pImagePreview').innerHTML=p.image?'<img src="'+p.image+'">':'<span style="color:#6B7B8C;font-size:.85rem;">Aucune image</span>';
    } else {
        document.getElementById('productModalTitle').textContent='Ajouter un produit';
        document.getElementById('productForm').reset();
        document.getElementById('pImagePreview').innerHTML='<span style="color:#6B7B8C;font-size:.85rem;">Aucune image</span>';
    }
    document.getElementById('modalProduct').classList.add('active');
}
document.getElementById('pImageFile').addEventListener('change', function(){
    var file=this.files[0]; if(!file)return;
    var r=new FileReader();
    r.onload=function(e){document.getElementById('pImagePreview').innerHTML='<img src="'+e.target.result+'">'; };
    r.readAsDataURL(file);
});
document.getElementById('productForm').addEventListener('submit', function(e){
    e.preventDefault();
    var products=getProducts();
    var imgEl=document.getElementById('pImagePreview').querySelector('img');
    var product={
        id:(editIdx!==null)?products[editIdx].id:Date.now(),
        name:document.getElementById('pName').value,
        category:document.getElementById('pCategory').value,
        description:document.getElementById('pDesc').value,
        price:parseInt(document.getElementById('pPrice').value),
        image:imgEl?imgEl.src:null
    };
    if(editIdx!==null){products[editIdx]=product;}else{products.push(product);}
    saveProducts(products);
    closeModal('modalProduct');
    renderProducts();
    renderDashboard();
});
function deleteProduct(idx){
    if(!confirm('Supprimer ce produit ?'))return;
    var products=getProducts(); products.splice(idx,1); saveProducts(products);
    renderProducts(); renderDashboard();
}

/* ---------- CATEGORIES ---------- */
function renderCategories(){
    var cats=getCategories(), products=getProducts();
    if(!cats.length){document.getElementById('categoriesTable').innerHTML='<div class="empty"><div class="icon"><i data-lucide="folder"></i></div><p>Aucune catégorie</p></div>';return;}
    var h='<table><thead><tr><th>Nom</th><th>Description</th><th>Produits</th><th>Action</th></tr></thead><tbody>';
    cats.forEach(function(c,i){
        var cnt=products.filter(function(p){return p.category===c.id;}).length;
        h+='<tr><td><strong>'+c.name+'</strong></td><td>'+(c.description||'-')+'</td><td>'+cnt+'</td><td><button class="btn btn-danger btn-sm" onclick="deleteCategory('+i+')"><i data-lucide="trash-2"></i> Supprimer</button></td></tr>';
    });
    document.getElementById('categoriesTable').innerHTML=h+'</tbody></table>';
}
function openCategoryModal(){ document.getElementById('categoryForm').reset(); document.getElementById('modalCategory').classList.add('active'); }
document.getElementById('categoryForm').addEventListener('submit', function(e){
    e.preventDefault();
    var cats=getCategories(), name=document.getElementById('cName').value;
    cats.push({id:name.toLowerCase().replace(/\s+/g,'-'),name:name,description:document.getElementById('cDesc').value});
    saveCategories(cats); closeModal('modalCategory'); renderCategories(); renderProducts();
});
function deleteCategory(idx){
    var cats=getCategories(), products=getProducts();
    var cnt=products.filter(function(p){return p.category===cats[idx].id;}).length;
    if(cnt>0){alert('Impossible : cette catégorie contient '+cnt+' produit(s).');return;}
    if(!confirm('Supprimer ?'))return;
    cats.splice(idx,1); saveCategories(cats); renderCategories();
}

/* ---------- ANNOUNCEMENTS ---------- */
function renderAnnouncements(){
    var ann=getAnnouncements();
    if(!ann.length){document.getElementById('announcementsTable').innerHTML='<div class="empty"><div class="icon"><i data-lucide="megaphone"></i></div><p>Aucune annonce</p></div>';return;}
    var h='<table><thead><tr><th>Message</th><th>Statut</th><th>Date</th><th>Action</th></tr></thead><tbody>';
    ann.forEach(function(a,i){
        h+='<tr><td>'+a.text+'</td><td><span class="badge badge-'+a.status+'">'+(a.status==='active'?'Active':'Inactive')+'</span></td><td>'+new Date(a.createdAt).toLocaleDateString('fr-FR')+'</td><td style="display:flex;gap:.5rem;"><button class="btn btn-sm '+(a.status==='active'?'btn-secondary':'btn-primary')+'" onclick="toggleAnnouncement('+i+')">'+(a.status==='active'?'Désactiver':'Activer')+'</button><button class="btn btn-danger btn-sm" onclick="deleteAnnouncement('+i+')"><i data-lucide="trash-2"></i></button></td></tr>';
    });
    document.getElementById('announcementsTable').innerHTML=h+'</tbody></table>';
}
function openAnnouncementModal(){ document.getElementById('announcementForm').reset(); document.getElementById('modalAnnouncement').classList.add('active'); }
document.getElementById('announcementForm').addEventListener('submit', function(e){
    e.preventDefault();
    var ann=getAnnouncements();
    ann.push({id:Date.now(),text:document.getElementById('aText').value,status:document.getElementById('aStatus').value,createdAt:new Date().toISOString()});
    saveAnnouncements(ann); closeModal('modalAnnouncement'); renderAnnouncements();
});
function toggleAnnouncement(idx){ var ann=getAnnouncements(); ann[idx].status=ann[idx].status==='active'?'inactive':'active'; saveAnnouncements(ann); renderAnnouncements(); }
function deleteAnnouncement(idx){ if(!confirm('Supprimer ?'))return; var ann=getAnnouncements(); ann.splice(idx,1); saveAnnouncements(ann); renderAnnouncements(); }


/* ---------- SETTINGS ---------- */
function getSettings() {
    const defaults = {
        whatsappNumber: '2250000000000',
        tiktokUsername: '@icejewelry',
        contactEmail: 'contact@icejewelry.ci',
        contactPhone: '+225 XX XX XX XX XX'
    };
    return JSON.parse(localStorage.getItem('iceJewelrySettings') || JSON.stringify(defaults));
}

function saveSettings(settings) {
    localStorage.setItem('iceJewelrySettings', JSON.stringify(settings));
}

function renderSettings() {
    const settings = getSettings();
    document.getElementById('whatsappNumber').value = settings.whatsappNumber;
    document.getElementById('tiktokUsername').value = settings.tiktokUsername;
    document.getElementById('contactEmail').value = settings.contactEmail;
    document.getElementById('contactPhone').value = settings.contactPhone;
}

document.getElementById('socialLinksForm')?.addEventListener('submit', function(e){
    e.preventDefault();
    const settings = {
        whatsappNumber: document.getElementById('whatsappNumber').value,
        tiktokUsername: document.getElementById('tiktokUsername').value,
        contactEmail: document.getElementById('contactEmail').value,
        contactPhone: document.getElementById('contactPhone').value
    };
    saveSettings(settings);
    alert('<i data-lucide="check-circle"></i> Paramètres enregistrés !\n\nLes nouveaux liens apparaîtront sur le site après rafraîchissement.');
});

function clearAllData() {
    localStorage.clear();
}

</script>



    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    

/* ---------- CHANGE CREDENTIALS ---------- */
document.getElementById('changeCredsForm')?.addEventListener('submit', async function(e){
    e.preventDefault();
    
    const newUser = document.getElementById('newUsername').value.trim();
    const newPass = document.getElementById('newPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    
    // Validation
    if (newUser.length < 5) {
        showCredsResult('❌ L\'identifiant doit faire minimum 5 caractères', 'error');
        return;
    }
    
    if (newPass.length < 8) {
        showCredsResult('❌ Le mot de passe doit faire minimum 8 caractères', 'error');
        return;
    }
    
    if (newPass !== confirmPass) {
        showCredsResult('❌ Les mots de passe ne correspondent pas', 'error');
        return;
    }
    
    if (!confirm(`⚠️ ATTENTION !\n\nVous allez changer vos identifiants pour :\n\nIdentifiant: ${newUser}\nMot de passe: ${newPass}\n\nNotez-les bien ! Continuer ?`)) {
        return;
    }
    
    // Hasher les nouveaux identifiants
    const userHash = await hashPassword(newUser);
    const passHash = await hashPassword(newPass);
    
    // Sauvegarder dans localStorage
    localStorage.setItem('customUserHash', userHash);
    localStorage.setItem('customPassHash', passHash);
    
    // Sauvegarder en clair pour référence (dans localStorage privé)
    localStorage.setItem('_myUsername', newUser);
    localStorage.setItem('_myPassword', newPass);
    
    showCredsResult('✅ Identifiants changés avec succès !\n\nNouveaux identifiants :\nIdentifiant: ' + newUser + '\nMot de passe: ' + newPass + '\n\nNotez-les maintenant !', 'success');
    
    // Reset form
    document.getElementById('changeCredsForm').reset();
    
    // Demander si l'utilisateur veut se déconnecter
    setTimeout(function(){
        if(confirm('Voulez-vous vous déconnecter pour tester les nouveaux identifiants ?')){
            logout();
        }
    }, 3000);
});

function showCredsResult(message, type){
    const resultDiv = document.getElementById('credsChangeResult');
    resultDiv.innerHTML = '<div style="padding:1rem; border-radius:5px; white-space:pre-wrap; background:' + 
        (type === 'success' ? '#d4edda; color:#155724; border:1px solid #c3e6cb' : '#f8d7da; color:#721c24; border:1px solid #f5c6cb') + 
        ';">' + message + '</div>';
}

function resetToDefaultCredentials(){
    if(!confirm('⚠️ Réinitialiser aux identifiants par défaut ?\n\nIdentifiant: EMMANUEL_MIESSAN\nMot de passe: MOSPE07IJ')){
        return;
    }
    
    localStorage.removeItem('customUserHash');
    localStorage.removeItem('customPassHash');
    localStorage.removeItem('_myUsername');
    localStorage.removeItem('_myPassword');
    
    alert('✅ Identifiants réinitialisés !\n\nIdentifiant: EMMANUEL_MIESSAN\nMot de passe: MOSPE07IJ');
    
    logout();
}

function clearAllData() {
    localStorage.clear();
}

/* ---------- SETTINGS ---------- */
function getSettings() {
    const defaults = {
        whatsappNumber: '2250000000000',
        tiktokUsername: '@icejewelry',
        contactEmail: 'contact@icejewelry.ci',
        contactPhone: '+225 XX XX XX XX XX'
    };
    return JSON.parse(localStorage.getItem('iceJewelrySettings') || JSON.stringify(defaults));
}

function saveSettings(settings) {
    localStorage.setItem('iceJewelrySettings', JSON.stringify(settings));
}

function renderSettings() {
    const settings = getSettings();
    if(document.getElementById('whatsappNumber')) document.getElementById('whatsappNumber').value = settings.whatsappNumber;
    if(document.getElementById('tiktokUsername')) document.getElementById('tiktokUsername').value = settings.tiktokUsername;
    if(document.getElementById('contactEmail')) document.getElementById('contactEmail').value = settings.contactEmail;
    if(document.getElementById('contactPhone')) document.getElementById('contactPhone').value = settings.contactPhone;
}

document.getElementById('socialLinksForm')?.addEventListener('submit', function(e){
    e.preventDefault();
    const settings = {
        whatsappNumber: document.getElementById('whatsappNumber').value,
        tiktokUsername: document.getElementById('tiktokUsername').value,
        contactEmail: document.getElementById('contactEmail').value,
        contactPhone: document.getElementById('contactPhone').value
    };
    saveSettings(settings);
    alert('✅ Paramètres enregistrés !\n\nLes nouveaux liens apparaîtront sur le site après rafraîchissement.');
});



/* Admin Sidebar Toggle for Mobile */
const adminToggle = document.getElementById('adminToggle');
const sidebar = document.querySelector('.sidebar');

if (adminToggle && sidebar) {
    adminToggle.addEventListener('click', function() {
        sidebar.classList.toggle('active');
    });
    
    // Close sidebar when clicking outside
    document.addEventListener('click', function(e) {
        if (window.innerWidth <= 768) {
            if (sidebar.classList.contains('active') && 
                !sidebar.contains(e.target) && 
                !adminToggle.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        }
    });
    
    // Close sidebar when clicking on a nav link
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('active');
            }
        });
    });
}



/* ========================================
   GESTION MULTI-IMAGES PRODUITS
======================================== */

// Prévisualisation des images sélectionnées
document.getElementById('pImages')?.addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    const previewContainer = document.getElementById('imagePreview');
    previewContainer.innerHTML = '';
    
    if (files.length > 5) {
        alert('Maximum 5 images par produit');
        e.target.value = '';
        return;
    }
    
    files.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function(event) {
            const preview = document.createElement('div');
            preview.style.cssText = 'position:relative; border:2px solid #E8F4F8; border-radius:8px; overflow:hidden;';
            preview.innerHTML = `
                <img src="${event.target.result}" style="width:100%; height:100px; object-fit:cover;">
                <div style="position:absolute; top:5px; right:5px; background:var(--ice-dark); color:white; padding:0.2rem 0.5rem; border-radius:3px; font-size:0.75rem;">
                    Photo ${index + 1}
                </div>
            `;
            previewContainer.appendChild(preview);
        };
        reader.readAsDataURL(file);
    });
});

// Modifier la soumission du formulaire produit
document.getElementById('productForm')?.addEventListener('submit', async function(e){
    e.preventDefault();
    
    const id = document.getElementById('pId').value || Date.now();
    const name = document.getElementById('pName').value.trim();
    const category = document.getElementById('pCat').value;
    const price = parseFloat(document.getElementById('pPrice').value);
    const description = document.getElementById('pDesc').value.trim();
    const isNew = document.getElementById('pIsNew').checked;
    const imageFiles = document.getElementById('pImages').files;
    
    // Convertir les images en base64
    const images = [];
    if (imageFiles.length > 0) {
        for (let i = 0; i < Math.min(imageFiles.length, 5); i++) {
            const base64 = await fileToBase64(imageFiles[i]);
            images.push(base64);
        }
    }
    
    const product = {
        id: id,
        name: name,
        category: category,
        price: price,
        description: description,
        images: images.length > 0 ? images : null,
        isNew: isNew,
        createdAt: new Date().toISOString()
    };
    
    let products = getProducts();
    const existingIndex = products.findIndex(function(p){ return p.id == id; });
    
    if (existingIndex > -1) {
        // Si pas de nouvelles images, garder les anciennes
        if (images.length === 0 && products[existingIndex].images) {
            product.images = products[existingIndex].images;
        }
        products[existingIndex] = product;
    } else {
        products.push(product);
    }
    
    saveProducts(products);
    closeModal('modalProduct');
    renderProducts();
    alert('✅ Produit enregistré avec ' + (product.images ? product.images.length : 0) + ' photo(s)');
});

// Helper: Convertir fichier en base64
function fileToBase64(file) {
    return new Promise(function(resolve, reject) {
        const reader = new FileReader();
        reader.onload = function() { resolve(reader.result); };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// Modifier renderProducts pour afficher le badge "NOUVEAU"
const originalRenderProducts = renderProducts;
renderProducts = function() {
    originalRenderProducts();
    
    // Ajouter des badges "NOUVEAU" visuellement
    const products = getProducts();
    products.forEach(function(product) {
        if (product.isNew) {
            const row = document.querySelector(`tr[data-product-id="${product.id}"]`);
            if (row) {
                const nameCell = row.querySelector('td:first-child');
                if (nameCell && !nameCell.querySelector('.new-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'new-badge';
                    badge.style.cssText = 'background:#27ae60; color:white; padding:0.2rem 0.5rem; border-radius:3px; font-size:0.7rem; margin-left:0.5rem;';
                    badge.textContent = 'NOUVEAU';
                    nameCell.appendChild(badge);
                }
            }
        }
    });
};


</script>
</body>
</html>
